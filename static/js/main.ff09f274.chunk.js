(this["webpackJsonproguelike-dungeon-crawler"]=this["webpackJsonproguelike-dungeon-crawler"]||[]).push([[0],{42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(5),c=n.n(i),o=n(1),s=n(2),l=n(15),u=n(16),h=n(6),p=n(7),E=function(){function e(){Object(h.a)(this,e)}return Object(p.a)(e,null,[{key:"TOTAL_ENTITIES",get:function(){return e.ENEMY_COUNT+e.HEALTH_COUNT+e.WEAPON_COUNT+e.BOSS_COUNT}}]),e}();E.WIDTH=77,E.HEIGHT=37,E.UNIT_WIDTH=16,E.UNIT_HEIGHT=16,E.PLAYER="Player",E.PLAYER_LEVELS=50,E.PLAYER_COUNT=1,E.BOSS="Boss",E.BOSS_LEVELS=10,E.BOSS_COUNT=1,E.WEAPON="Weapon",E.WEAPON_LEVELS=3,E.WEAPON_COUNT=3,E.HEALTH="Health",E.HEALTH_LEVELS=6,E.HEALTH_COUNT=20,E.ENEMY="Enemy",E.ENEMY_LEVELS=9,E.ENEMY_COUNT=40,E.ENEMY_MAX_HEALTH=300;var d=n(4);function f(e){return Math.floor(Math.random()*e)}function v(e,t){return f(t-e)+e}function T(e){for(var t,n,r=0,a=0;a<e;a++)r+=Math.round((t=1,n=6,Math.random()*(n-t)+t));return r}function g(e,t,n){if(!(n<1)){var r=0;do{r=T(n),r-=3.5*n}while(r<0);var a=r/6;return Math.floor(a*(t-e)+e)}}var m=n(17),y=n.n(m);var O={0:1,1:0,3:3,4:9,5:9,6:9,7:7,12:9,13:0,14:9,15:7,16:0,17:0,19:2,20:9,21:9,22:9,23:7,24:5,25:2,28:8,29:8,30:8,31:0,48:0,49:1,51:0,52:9,57:2,60:8,63:6,55:7,56:0,61:8,64:4,65:1,68:12,69:12,70:12,71:7,76:12,78:12,79:7,80:1,81:5,84:12,85:12,87:7,88:3,92:8,93:8,94:8,95:0,96:1,97:0,100:12,102:12,103:7,112:6,113:5,115:0,116:12,117:12,118:12,119:7,120:0,121:0,124:11,125:11,126:11,127:14,129:0,131:0,133:9,135:7,145:2,147:2,151:7,153:0,157:8,159:5,192:2,193:5,195:0,196:12,197:12,199:10,204:12,205:12,207:10,208:0,209:2,211:0,213:12,215:10,217:0,220:1,221:8,223:13,224:0,225:0,228:12,229:12,231:10,240:3,241:0,243:1,244:12,245:9,247:10,249:0,252:11,253:11};function b(e,t){for(var n=function(e,t){var n=y.a.build({width:e,height:t});return n.width=e,n.height=t,n.get=function(n,r){return!(n<0||n>=e)&&!(r<0||r>=t)&&this.tiles[n][r]},n.check=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!(this.get(e,t)||!r)||this.get(e,t)&&this.get(e,t).type===n},n.get4BitMask=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.check(e,t-1,n,r),i=this.check(e+1,t,n,r),c=this.check(e,t+1,n,r),o=this.check(e-1,t,n,r);return"".concat(+a).concat(+i).concat(+c).concat(+o)},n.get8BitMask=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.check(e-1,t-1,n,r),i=this.check(e,t-1,n,r),c=this.check(e+1,t-1,n,r),o=this.check(e+1,t,n,r),s=this.check(e+1,t+1,n,r),l=this.check(e,t+1,n,r),u=this.check(e-1,t+1,n,r),h=this.check(e-1,t,n,r);return"".concat(+a).concat(+i).concat(+c).concat(+o).concat(+s).concat(+l).concat(+u).concat(+h)},n}(e,t),r=0;r<e;r++)for(var a=0;a<t;a++){var i=n.get(r,a).type;if("wall"===i){var c=n.get8BitMask(r,a,"wall",!0),o=parseInt(c,2)||0;n.tiles[r][a].texture="undefined"===typeof O[o]?"empty":O[o],n.tiles[r][a].orig=o}else"floor"!==i&&"door"!==i||(n.tiles[r][a].texture="15");n.tiles[r][a].x=r,n.tiles[r][a].y=a,delete n.tiles[r][a].neighbours,delete n.tiles[r][a].nesw}return n}function S(e){return{x:v(e.x,e.x+e.width),y:v(e.y,e.y+e.height)}}function _(e){return S(e[f(e.length)])}var w=b(E.WIDTH,E.HEIGHT),P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_DATA":return b(E.WIDTH,E.HEIGHT);default:return e}},x={top:0,left:0},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_DATA":return x;case"SET_SCREEN_OFFSET":return Object.assign({},e,{top:t.top,left:t.left});default:return e}},k={fogOn:!0,defeat:!1,victory:!1,blood:!1},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_DATA":return k;case"TOGGLE_FOG":return Object.assign({},e,{fogOn:!e.fogOn});case"ATTACK_SPRITE":return Object.assign({},e,{blood:!0});case"SET_BLOOD":return Object.assign({},e,{blood:e.value});case"DEFEAT":return Object.assign({},e,{defeat:!0});case"VICTORY":return Object.assign({},e,{victory:!0});default:return e}},N=n(49),H={},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SPAWN_SPRITE":var n=g(100,150+100*t.level,t.level),r=g(40,50+20*t.level,t.level);return{id:Object(N.a)(),power:r,health:n,maxHealth:n,level:t.level,x:t.x,y:t.y,name:t.name,experience:0};case"SET_SPRITE_POSITION":return e.id!==t.id?e:Object.assign({},e,{x:t.x,y:t.y});case"SET_SPRITE_HEALTH":return e.id!==t.id?e:Object.assign({},e,{health:t.health});case"SET_SPRITE_POWER":return e.id!==t.id?e:Object.assign({},e,{power:t.power});case"ATTACK_SPRITE":return e.id!==t.id?e:Object.assign({},e,{health:e.health-t.damage});case"ADD_EXPERIENCE":if(e.id!==t.id)return e;var a=e.experience,i=t.experience,c=a+i,o=e.level,s=e.power,l=e.health,u=e.maxHealth,h=50+50*o;for(console.log("adding exp:",c);c>h;)o+=1,s*=1.1,l=Math.max(u,l),c%=h,h=50+50*o;return Object.assign({},e,{experience:c,power:Math.round(s),health:l,level:o});default:return e}},R=[],j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_DATA":return R;case"SPAWN_SPRITE":return[].concat(Object(d.a)(e),[L(void 0,t)]);case"DESTROY_SPRITE":return Object(d.a)(e.filter((function(e){return e.id!==t.id})));case"ATTACK_SPRITE":case"SET_SPRITE_POSITION":case"SET_SPRITE_HEALTH":case"SET_SPRITE_POWER":case"ADD_EXPERIENCE":return e.map((function(e){return L(e,t)}));default:return e}},M=Object(s.combineReducers)({sprites:j,map:P,screen:I,effects:A}),D=n(8),W=n(19),C=n(18),Y=(n(42),function(e){var t=e.texture,n=e.orig;return a.a.createElement("td",{className:"tile tile-".concat(t," ").concat(n)})}),B=(n(43),function(e){for(var t=e.tiles,n=[],r=[],i=0;i<t[0].length;i++){for(var c=0;c<t.length;c++)r.push(a.a.createElement(Y,Object.assign({key:c},t[c][i])));n.push(a.a.createElement("tr",{key:i},r)),r=[]}return a.a.createElement("table",null,a.a.createElement("tbody",null,n))}),G=Object(o.b)((function(e,t){return{tiles:e.map.tiles}}))(B),U=n(3),F=function(e,t,n){return{type:"SPAWN_SPRITE",name:e,level:t,x:n.x,y:n.y}},V=function(e){var t=e.zIndex,n=e.style,r=e.children,i={position:"fixed",left:0,top:0,right:0,bottom:0,zIndex:t},c=Object.assign({},i,n);return a.a.createElement("div",{style:c},r)},z=Object(o.b)((function(e,t){return Object(U.a)({},e.effects)}),(function(e,t){return{disableBlood:function(){e({type:"SET_BLOOD",value:!1})}}}))((function(e,t){return e.defeat?a.a.createElement(V,{zIndex:3,style:{backgroundColor:"black",display:"flex",alignItems:"center",justifyContent:"center"}},a.a.createElement("div",{style:{color:"white",maxWidth:"50%",textAlign:"center"}},a.a.createElement("h3",null,"DEFEAT"),a.a.createElement("h4",null,"Press 'r' to try again"))):e.victory?a.a.createElement(V,{zIndex:3,style:{backgroundColor:"black",display:"flex",alignItems:"center",justifyContent:"center"}},a.a.createElement("div",{style:{color:"white",maxWidth:"50%",textAlign:"center"}},a.a.createElement("h3",null,"VICTORY"),a.a.createElement("h4",null,"Press 'r' to play again"))):e.blood?(setTimeout(e.disableBlood.bind(undefined),175),a.a.createElement(V,{zIndex:3,style:{backgroundImage:"radial-gradient(circle farthest-corner at center, rgba(0,0,0,0) 0px, rgba(50,0,0,0.6) 40px, rgba(75,0,0,0.95) 80px, rgba(20,0,0,1) 120px, rgba(0,0,0,1) 100%)"}})):e.fogOn?a.a.createElement(V,{zIndex:3,style:{transition:"opacity 3s ease-in-out",backgroundImage:"radial-gradient(circle farthest-corner at center, rgba(0,0,0,0) 0px, rgba(0,0,0,0.6) 40px, rgba(0,0,0,0.95) 80px, rgba(0,0,0,1) 120px, rgba(0,0,0,1) 100%)"}}):null})),K=(n(44),function(e){var t=e.name,n=e.level,r=e.health,i=e.maxHealth,c=e.x,o=e.y,s=E.UNIT_WIDTH,l=E.UNIT_HEIGHT,u={position:"absolute",left:c*s,top:o*l,width:s,height:l,opacity:.3+r/i};return a.a.createElement("div",{className:"sprite ".concat(t,"-").concat(n),style:u})}),X=function(e){var t=e.sprites.map((function(e,t){return a.a.createElement(K,Object.assign({key:t},e))}));return a.a.createElement("div",null,t)},J=Object(o.b)((function(e,t){return{sprites:e.sprites.filter((function(e){return e.health>0&&e.name===E.ENEMY}))}}))(X),q=Object(o.b)((function(e,t){var n=e.sprites.filter((function(e){return e.health>0&&e.name===E.PLAYER}));return Object(U.a)({},n[0])}))(K),Q=Object(o.b)((function(e,t){return{sprites:e.sprites.filter((function(e){return e.name===E.HEALTH}))}}))(X),Z=Object(o.b)((function(e,t){return{sprites:e.sprites.filter((function(e){return e.name===E.WEAPON}))}}))(X),$=(n(45),function(e){var t=e.level,n=e.health,r=e.power;return a.a.createElement("div",{className:"NavBar"},a.a.createElement("div",null,"Level: ".concat(t||0)),a.a.createElement("div",null,"HP: ".concat(n||0)),a.a.createElement("div",null,"Atk: ".concat(r||0)))}),ee=Object(o.b)((function(e,t){var n=e.sprites.filter((function(e){return e.health>0&&e.name===E.PLAYER}))[0];return Object(U.a)({},n)}))($),te=Object(o.b)((function(e,t){return{sprites:e.sprites.filter((function(e){return e.health>0&&e.name===E.BOSS}))}}))(X),ne=function(e,t){var n,r,a,i,c,o,s=e,l=t||function(e){};s.addEventListener("touchstart",(function(e){var t=e.changedTouches[0];n="none",r=t.pageX,a=t.pageY,o=(new Date).getTime(),e.preventDefault()}),!1),s.addEventListener("touchmove",(function(e){e.preventDefault()}),!1),s.addEventListener("touchend",(function(e){var t=e.changedTouches[0];i=t.pageX-r,c=t.pageY-a,(new Date).getTime()-o<=300&&(Math.abs(i)>=30&&Math.abs(c)<=100?n=i<0?"left":"right":Math.abs(c)>=30&&Math.abs(i)<=100&&(n=c<0?"up":"down")),l(n),e.preventDefault()}),!1)},re=function(e){Object(W.a)(n,e);var t=Object(C.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).handleKeyPress=r.handleKeyPress.bind(Object(D.a)(r)),r}return Object(p.a)(n,[{key:"centerOn",value:function(e,t){var n=window,r=document,a=r.documentElement,i=r.getElementsByTagName("body")[0],c=n.innerWidth||a.clientWidth||i.clientWidth,o=n.innerHeight||a.clientHeight||i.clientHeight;this.props.setScreen({left:c/2-e*E.UNIT_WIDTH,top:o/2-t*E.UNIT_HEIGHT})}},{key:"centerOnPlayer",value:function(){var e=this.props.player,t=e.x,n=e.y;this.centerOn(t,n)}},{key:"resetGame",value:function(){var e=this.props.resetGame(),t=e.x,n=e.y;this.centerOn(t,n)}},{key:"battleEnemy",value:function(e){var t=this.props.player,n=t.health-e.power;if(e.health-t.power<=0)e.name===E.BOSS?this.props.victory():(this.props.destroy(e.id),this.props.addExperience(t.id,(e.maxHealth+e.power)/2));else{if(n<=0)return this.props.defeat();this.props.attackSprite(t.id,e.power),this.props.attackSprite(e.id,t.power)}}},{key:"usePotion",value:function(e){var t=this.props.player;this.props.destroy(e.id),this.props.healTo(t.id,t.health+e.health)}},{key:"upgradeWeapon",value:function(e){var t=this.props.player;this.props.setPower(t.id,t.power+e.power),this.props.destroy(e.id)}},{key:"handleSprites",value:function(e){var t=this.props.sprites;if(t.has(e)){var n=t.get(e);switch(n.name){case E.ENEMY:case E.BOSS:this.battleEnemy(n);break;case E.HEALTH:this.usePotion(n);break;case E.WEAPON:this.upgradeWeapon(n);break;default:return}}}},{key:"movePlayer",value:function(e,t){var n="".concat(e,"x").concat(t),r=this.props,a=r.tiles,i=r.sprites,c=r.player;return i.has(n)?this.handleSprites(n):"wall"!==a[e][t].type?(this.centerOn(e,t),this.props.moveSprite(c.id,e,t)):void 0}},{key:"handleSwipe",value:function(e){var t=this.props.player,n=t.x,r=t.y;switch(e){case"left":n-=1;break;case"right":n+=1;break;case"up":r-=1;break;case"down":r+=1;break;default:return}this.movePlayer(n,r)}},{key:"handleKeyPress",value:function(e){var t=e.which;t>=37&&t<=40&&e.preventDefault();var n=this.props.player,r=n.x,a=n.y;switch(t){case 82:this.resetGame();break;case 87:case 38:a-=1;break;case 83:case 40:a+=1;break;case 65:case 37:r-=1;break;case 68:case 39:r+=1;break;case 72:this.props.toggleFog();break;default:return}this.movePlayer(r,a)}},{key:"componentWillMount",value:function(){var e=this.props.setupGame(this.props.rooms),t=e.x,n=e.y;this.centerOn(t,n)}},{key:"componentDidMount",value:function(){ne(window,this.handleSwipe.bind(this)),window.addEventListener("keydown",this.handleKeyPress.bind(this)),window.onresize=this.centerOnPlayer.bind(this)}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(ee,null),a.a.createElement(z,null),a.a.createElement("div",{style:{left:"".concat(this.props.screen.left,"px"),top:"".concat(this.props.screen.top,"px"),position:"fixed"}},a.a.createElement(G,null),a.a.createElement(q,null),a.a.createElement(Q,null),a.a.createElement(Z,null),a.a.createElement(te,null),a.a.createElement(J,null)))}}]),n}(r.Component),ae={generateMap:b,getRandomSpawn:_,getSpawnFromRoom:S,getMultipleSpawns:function(e,t){for(var n=new Map;n.size<t;){var r=_(e);n.set("".concat(r.x,"x").concat(r.y),r)}return Object(d.a)(n.values())}},ie=Object(o.b)((function(e,t){var n=new Map,r=e.sprites.filter((function(e){return e.name===E.PLAYER}))[0];return e.sprites.forEach((function(e){n.set("".concat(e.x,"x").concat(e.y),e)})),{tiles:e.map.tiles,rooms:e.map.rooms,screen:e.screen,sprites:n,player:r,game:e.game}}),(function(e,t){var n=function(t,n,r,a){for(var i=0;i<r;i++){e(F(t,i%n+1,a.pop()))}},r=function(e,t){var r=t().map.rooms,a=ae.getSpawnFromRoom(r[0]),i=ae.getMultipleSpawns(r.slice(1),100);return n(E.ENEMY,E.ENEMY_LEVELS,E.ENEMY_COUNT,i),n(E.HEALTH,E.HEALTH_LEVELS,E.HEALTH_COUNT,i),n(E.WEAPON,E.WEAPON_LEVELS,E.WEAPON_COUNT,i),e(F(E.BOSS,E.BOSS_LEVELS,i.pop())),e(F(E.PLAYER,1,a)),a};return{destroy:function(t){e(function(e){return{type:"DESTROY_SPRITE",id:e}}(t))},healTo:function(t,n){e(function(e,t){return{type:"SET_SPRITE_HEALTH",id:e,health:t}}(t,n))},attackSprite:function(t,n){e(function(e,t){return{type:"ATTACK_SPRITE",id:e,damage:t}}(t,n))},setPower:function(t,n){e(function(e,t){return{type:"SET_SPRITE_POWER",id:e,power:t}}(t,n))},setScreen:function(t){var n=t.top,r=t.left;e(function(e,t){return{type:"SET_SCREEN_OFFSET",top:e,left:t}}(n,r))},moveSprite:function(t,n,r){e(function(e,t,n){return{type:"SET_SPRITE_POSITION",id:e,x:t,y:n}}(t,n,r))},toggleFog:function(){e({type:"TOGGLE_FOG"})},setupGame:function(){return e(r)},defeat:function(){e({type:"DEFEAT"})},victory:function(){e({type:"VICTORY"})},resetGame:function(){return e({type:"RESET_DATA"}),e(r)},addExperience:function(t,n){e(function(e,t){return{type:"ADD_EXPERIENCE",id:e,experience:t}}(t,n))}}}))(re),ce=(n(46),Object(s.createStore)(M,Object(l.composeWithDevTools)(Object(s.applyMiddleware)(u.a))));c.a.render(a.a.createElement(o.a,{store:ce},a.a.createElement(ie,null)),document.getElementById("root"))}},[[47,1,2]]]);
//# sourceMappingURL=main.ff09f274.chunk.js.map